---
phase: 01-secure-server
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - .gitignore
  - addin/index.html
  - certs/localhost.pem
  - certs/localhost-key.pem
autonomous: true

must_haves:
  truths:
    - "npm install completes without errors and node_modules/ contains ws"
    - "TLS certificate files exist in certs/ and are trusted by macOS Keychain"
    - "addin/index.html exists as a serveable HTML page"
    - "npm start script points to server/index.ts"
  artifacts:
    - path: "package.json"
      provides: "Project config with ESM, scripts, and dependencies"
      contains: "type.*module"
    - path: "tsconfig.json"
      provides: "TypeScript type checking config (not build)"
      contains: "erasableSyntaxOnly"
    - path: ".gitignore"
      provides: "Excludes certs and node_modules from git"
      contains: "certs/"
    - path: "certs/localhost.pem"
      provides: "TLS certificate for localhost"
    - path: "certs/localhost-key.pem"
      provides: "TLS private key for localhost"
    - path: "addin/index.html"
      provides: "Placeholder HTML page for static file serving"
      min_lines: 5
  key_links:
    - from: "package.json"
      to: "server/index.ts"
      via: "start script"
      pattern: "node server/index\\.ts"
    - from: ".gitignore"
      to: "certs/"
      via: "gitignore entry"
      pattern: "certs/"
---

<objective>
Create the project foundation: npm package config, TypeScript config, gitignore, npm dependencies, TLS certificates via mkcert, and a placeholder add-in HTML page.

Purpose: Everything the HTTPS+WSS server (Plan 02) needs to exist before it can be written and started. Without these files, there are no dependencies to import, no certs to load, and no static files to serve.
Output: A fully configured Node.js project with trusted TLS certificates and a placeholder page ready for the server to serve.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-secure-server/01-RESEARCH.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project config files and install dependencies</name>
  <files>package.json, tsconfig.json, .gitignore</files>
  <action>
Create three config files at the project root:

**package.json:**
- `"name": "powerpoint-bridge"`
- `"version": "0.1.0"`
- `"type": "module"` (ESM — required for Node.js native TS with import syntax)
- `"scripts"`:
  - `"start": "node server/index.ts"` (Node 24 runs .ts natively, no build step)
  - `"typecheck": "tsc --noEmit"` (type checking only, not compilation)
  - `"setup-certs": "mkdir -p certs && mkcert -cert-file certs/localhost.pem -key-file certs/localhost-key.pem localhost 127.0.0.1 ::1"`
- `"dependencies"`: `"ws": "^8.19.0"` (WebSocket server — Node 24 has no native WS server)
- `"devDependencies"`: `"@types/ws": "^8.18.1"`, `"@types/node": "^22.0.0"`, `"typescript": "^5.9.0"`

**tsconfig.json:**
- `"target": "ESNext"`
- `"module": "NodeNext"` + `"moduleResolution": "NodeNext"` (matches Node ESM resolution)
- `"noEmit": true` (Node runs .ts directly; tsc is only for checking)
- `"strict": true`
- `"erasableSyntaxOnly": true` (errors on enums which Node 24 type stripping cannot handle)
- `"verbatimModuleSyntax": true` (forces import type for type-only imports)
- `"skipLibCheck": true`
- `"resolveJsonModule": true`
- `"isolatedModules": true`
- `"include": ["server/**/*.ts"]`
- `"exclude": ["node_modules"]`

**.gitignore:**
- `node_modules/`
- `certs/`
- `*.pem`

Then run `npm install` to install all dependencies.
  </action>
  <verify>
1. `cat package.json` shows type:module and ws dependency
2. `cat tsconfig.json` shows erasableSyntaxOnly:true
3. `cat .gitignore` shows certs/ and node_modules/
4. `ls node_modules/ws/` exists (npm install succeeded)
5. `npx tsc --noEmit` runs without errors (may warn about missing server/ — that is expected)
  </verify>
  <done>package.json, tsconfig.json, and .gitignore exist with correct contents. npm dependencies are installed in node_modules/.</done>
</task>

<task type="auto">
  <name>Task 2: Generate TLS certificates and create placeholder page</name>
  <files>certs/localhost.pem, certs/localhost-key.pem, addin/index.html</files>
  <action>
**TLS certificates:**

1. Check if mkcert is installed: `which mkcert`. If not found, run `brew install mkcert`.
2. Check if mkcert CA is already installed: `mkcert -CAROOT` should return a path with a rootCA.pem. If the CA root file does not exist, run `mkcert -install` (this will prompt the user for their macOS password to trust the CA in Keychain — this is normal and expected on macOS 11.3+).
3. Generate certificates with explicit filenames (do NOT rely on mkcert's default naming which varies): `mkdir -p certs && mkcert -cert-file certs/localhost.pem -key-file certs/localhost-key.pem localhost 127.0.0.1 ::1`

IMPORTANT: Use `-cert-file` and `-key-file` flags. Without them, mkcert names files `localhost+2.pem` and `localhost+2-key.pem` because of the 3 SANs, and the server would fail to find them.

**Placeholder HTML page:**

Create `addin/index.html` — a minimal but complete HTML page:
- DOCTYPE html, html lang="en", head with charset and viewport meta
- Title: "PowerPoint Bridge"
- Body with:
  - An h1: "PowerPoint Bridge"
  - A paragraph with id="status": "Server is running. Waiting for add-in connection..."
- Minimal inline CSS for readability (centered text, system font stack)

This page proves HTTPS static serving works and will later be replaced by the actual Office.js add-in taskpane.
  </action>
  <verify>
1. `ls -la certs/localhost.pem certs/localhost-key.pem` — both files exist
2. `openssl x509 -in certs/localhost.pem -noout -subject` — shows CN=localhost
3. `openssl x509 -in certs/localhost.pem -noout -ext subjectAltName` — shows localhost, 127.0.0.1, ::1
4. `cat addin/index.html` — shows valid HTML with "PowerPoint Bridge" heading
5. `git status` — certs/ should NOT appear (gitignored)
  </verify>
  <done>TLS certificate and key exist in certs/ with correct SANs (localhost, 127.0.0.1, ::1). The CA is trusted in macOS Keychain. addin/index.html exists as a valid HTML page. Certificate files are gitignored.</done>
</task>

</tasks>

<verification>
1. All config files exist: package.json (type:module), tsconfig.json (erasableSyntaxOnly), .gitignore (certs/)
2. node_modules/ws/ exists (dependencies installed)
3. certs/localhost.pem and certs/localhost-key.pem exist with correct SANs
4. addin/index.html is a valid HTML file
5. `git status` does not show certs/ or node_modules/ as untracked
</verification>

<success_criteria>
- `npm install` has completed successfully (ws in node_modules)
- TLS certs exist with localhost + 127.0.0.1 + ::1 SANs
- mkcert CA is trusted in macOS Keychain
- addin/index.html is a valid HTML page ready to be served
- All files properly gitignored
</success_criteria>

<output>
After completion, create `.planning/phases/01-secure-server/01-01-SUMMARY.md`
</output>
