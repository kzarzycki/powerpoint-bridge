---
phase: 02-powerpoint-addin
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - addin/manifest.xml
  - addin/index.html
  - addin/style.css
  - addin/assets/icon-16.png
  - addin/assets/icon-32.png
  - addin/assets/icon-80.png
  - package.json
autonomous: true

must_haves:
  truths:
    - "addin/manifest.xml is valid XML with correct element ordering per Office.js schema"
    - "https://localhost:8443 serves the taskpane HTML with Office.js CDN script in head"
    - "https://localhost:8443/assets/icon-16.png, icon-32.png, icon-80.png all return valid PNG images"
    - "manifest.xml SourceLocation points to https://localhost:8443/index.html"
  artifacts:
    - path: "addin/manifest.xml"
      provides: "XML manifest for sideloading into PowerPoint"
      contains: "OfficeApp"
    - path: "addin/index.html"
      provides: "Office.js taskpane HTML page"
      contains: "appsforoffice.microsoft.com/lib/1/hosted/office.js"
    - path: "addin/style.css"
      provides: "Taskpane styles"
    - path: "addin/assets/icon-16.png"
      provides: "16x16 ribbon icon"
    - path: "addin/assets/icon-32.png"
      provides: "32x32 ribbon icon"
    - path: "addin/assets/icon-80.png"
      provides: "80x80 ribbon icon"
  key_links:
    - from: "addin/manifest.xml"
      to: "https://localhost:8443/index.html"
      via: "SourceLocation DefaultValue"
      pattern: "SourceLocation.*https://localhost:8443/index.html"
    - from: "addin/index.html"
      to: "Office.js CDN"
      via: "script tag in head"
      pattern: "appsforoffice.microsoft.com/lib/1/hosted/office.js"
    - from: "addin/index.html"
      to: "addin/app.js"
      via: "script tag in body"
      pattern: 'src="app.js"'
---

<objective>
Create the Office.js add-in static files: manifest XML for sideloading, taskpane HTML with Office.js initialization, CSS styles, and ribbon icon images.

Purpose: These are the foundational files that let PowerPoint discover and load the add-in. The manifest tells PowerPoint where to find the taskpane (https://localhost:8443), and the HTML page initializes Office.js. The WebSocket client (app.js) is created in Plan 02-02.

Output: All static files for the add-in served by the existing HTTPS server, plus manifest ready for sideloading.
</objective>

<execution_context>
@/Users/zarz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zarz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-powerpoint-addin/02-RESEARCH.md
@server/index.ts
@addin/index.html
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create manifest.xml, icon assets, and sideload script</name>
  <files>addin/manifest.xml, addin/assets/icon-16.png, addin/assets/icon-32.png, addin/assets/icon-80.png, package.json</files>
  <action>
    1. Create `addin/manifest.xml` following the EXACT element ordering from the research (xs:sequence is enforced):
       Id, Version, ProviderName, DefaultLocale, DisplayName, Description, IconUrl, HighResolutionIconUrl, SupportUrl, AppDomains, Hosts, DefaultSettings, Permissions, VersionOverrides.

       Use GUID: AE89909C-2813-4B08-9E1B-49E7379BD0E6
       - SourceLocation: https://localhost:8443/index.html
       - Host: Presentation
       - Permissions: ReadWriteDocument
       - VersionOverrides: ribbon button on Home tab with ShowTaskpane action
       - Icon resids pointing to https://localhost:8443/assets/icon-16.png, icon-32.png, icon-80.png
       - Group label: "Bridge", Button label: "PowerPoint Bridge"
       - Omit FunctionFile element (not needed for ShowTaskpane-only actions)

       Use EXACTLY the XML structure from 02-RESEARCH.md "Complete XML Manifest" section, replacing the placeholder GUID with the one above.

    2. Create `addin/assets/` directory with three solid-color PNG icons (16x16, 32x32, 80x80).
       Generate these using a temporary Node.js script that creates minimal valid PNG files with built-in `node:zlib` — solid #0078D4 (Microsoft blue) fill. Run the script once, verify the files exist, then delete the script.

       Alternative if PNG generation is complex: create minimal 1x1 PNG files using known base64-encoded bytes and write them directly. The icons just need to be valid PNGs that load without error. Visual quality does not matter for a dev tool.

    3. Add sideload script to package.json scripts:
       ```
       "sideload": "mkdir -p ~/Library/Containers/com.microsoft.Powerpoint/Data/Documents/wef && cp addin/manifest.xml ~/Library/Containers/com.microsoft.Powerpoint/Data/Documents/wef/"
       ```
  </action>
  <verify>
    - `cat addin/manifest.xml | head -5` shows valid XML declaration and OfficeApp root
    - `file addin/assets/icon-16.png` reports PNG image
    - `file addin/assets/icon-32.png` reports PNG image
    - `file addin/assets/icon-80.png` reports PNG image
    - `node -e "JSON.parse(require('fs').readFileSync('package.json')).scripts.sideload"` prints the sideload command
  </verify>
  <done>
    manifest.xml exists with correct GUID, element ordering, and all URLs pointing to localhost:8443. Three PNG icon files exist in addin/assets/. package.json has sideload script.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace index.html with Office.js taskpane and create style.css</name>
  <files>addin/index.html, addin/style.css</files>
  <action>
    1. Replace `addin/index.html` (currently a placeholder) with proper Office.js taskpane HTML:

       ```html
       <!DOCTYPE html>
       <html lang="en">
       <head>
         <meta charset="UTF-8">
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title>PowerPoint Bridge</title>
         <!-- Office.js MUST be in head, before any other scripts -->
         <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js" type="text/javascript"></script>
         <link rel="stylesheet" href="style.css">
       </head>
       <body>
         <h1>PowerPoint Bridge</h1>
         <div id="status" class="status disconnected">Initializing...</div>
         <script src="app.js"></script>
       </body>
       </html>
       ```

       Key points:
       - Office.js CDN script MUST be in `<head>` (not body — it won't initialize correctly otherwise)
       - app.js script at end of body (created in Plan 02-02)
       - #status element for connection state display

    2. Create `addin/style.css` with minimal taskpane styling:
       - System font stack (already used in placeholder)
       - Centered layout for the narrow taskpane (~348px default width)
       - Status indicator with color coding: green dot + text for connected, red dot + text for disconnected, yellow for connecting
       - Avoid top-right 34x32px area (personality menu on macOS)
       - Keep it minimal — this is a dev tool, not a consumer product
       - Use CSS classes `.connected`, `.disconnected`, `.connecting` on #status element for color states

    3. Verify the server serves the updated files:
       - Start server with `node server/index.ts`
       - curl https://localhost:8443 returns the new HTML with Office.js script tag
       - curl https://localhost:8443/style.css returns CSS
       - Stop the server
  </action>
  <verify>
    Start the server and verify with curl:
    ```bash
    # Start server in background
    node server/index.ts &
    SERVER_PID=$!
    sleep 1

    # Verify HTML has Office.js CDN
    curl -sk https://localhost:8443 | grep -q "appsforoffice.microsoft.com" && echo "OK: Office.js CDN" || echo "FAIL: Office.js CDN missing"

    # Verify HTML has app.js reference
    curl -sk https://localhost:8443 | grep -q 'src="app.js"' && echo "OK: app.js ref" || echo "FAIL: app.js ref missing"

    # Verify CSS served
    curl -sk -o /dev/null -w "%{http_code}" https://localhost:8443/style.css | grep -q "200" && echo "OK: style.css" || echo "FAIL: style.css"

    # Verify icons served
    curl -sk -o /dev/null -w "%{http_code}" https://localhost:8443/assets/icon-32.png | grep -q "200" && echo "OK: icon" || echo "FAIL: icon"

    kill $SERVER_PID
    ```
  </verify>
  <done>
    index.html has Office.js CDN script in head, app.js reference in body, and #status element. style.css provides connection status color coding. All files served correctly by the HTTPS server on port 8443.
  </done>
</task>

</tasks>

<verification>
1. addin/manifest.xml is valid XML with OfficeApp root, correct GUID, SourceLocation pointing to https://localhost:8443/index.html
2. addin/index.html loads Office.js from CDN in head, references app.js and style.css
3. addin/style.css has connection status styling classes
4. Three PNG icon files exist in addin/assets/ (16, 32, 80)
5. package.json has sideload script
6. HTTPS server serves all files without 404 errors (except app.js which is created in Plan 02-02)
</verification>

<success_criteria>
- manifest.xml passes basic XML validation and contains all required elements in correct order
- index.html has Office.js CDN script tag in head section
- All static assets (HTML, CSS, PNGs) served via HTTPS on port 8443
- sideload npm script exists and references correct wef directory path
</success_criteria>

<output>
After completion, create `.planning/phases/02-powerpoint-addin/02-01-SUMMARY.md`
</output>
